---
layout:     post
title:      Asset Catalog 逆向
subtitle:   
date:       2020-03-23
author:     LML
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Xcode Image
    - 逆向
---

# 前言
本系列文章主要介绍 Xcode 对图片的处理 和图片相关的介绍：  

+ Xcode 对图片的处理 
	+ Asset Catalog 逆向
	+ UIImage 加载图片的相关方法、加载流程、缓存原理等
+ 图片相关知识
	+ 几种图片格式的对比
	+ 图片编码、无损压缩与有损压缩
	+ 图片处理相关工具
本篇主要介绍 UIImage 加载图片的相关方法、加载流程、缓存原理等。

# 相关API介绍
## UIImage API
### imageNamed相关
```
+ (nullable UIImage *)imageNamed:(NSString *)name;      // load from main bundle
+ (nullable UIImage *)imageNamed:(NSString *)name inBundle:(nullable NSBundle *)bundle withConfiguration:(nullable UIImageConfiguration *)configuration API_AVAILABLE(ios(13.0),tvos(13.0),watchos(6.0));
#if __has_include(<UIKit/UITraitCollection.h>)
+ (nullable UIImage *)imageNamed:(NSString *)name inBundle:(nullable NSBundle *)bundle compatibleWithTraitCollection:(nullable UITraitCollection *)traitCollection API_AVAILABLE(ios(8.0));  
```  
+ UIImageConfiguration 是对UITraitCollection的封装
	+ The iOS interface environment for your app, defined by traits such as horizontal and vertical size class, display scale, and user interface idiom.
	![](https://pic.downk.cc/item/5e9da07dc2a9a83be5b6a7a2.jpg)
	
### 其他
```。
+ (nullable UIImage *)imageWithContentsOfFile:(NSString *)path;
+ (nullable UIImage *)imageWithData:(NSData *)data;
+ (nullable UIImage *)imageWithData:(NSData *)data scale:(CGFloat)scale API_AVAILABLE(ios(6.0));
+ (UIImage *)imageWithCGImage:(CGImageRef)cgImage;
+ (UIImage *)imageWithCGImage:(CGImageRef)cgImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation API_AVAILABLE(ios(4.0));
#if __has_include(<CoreImage/CoreImage.h>)
+ (UIImage *)imageWithCIImage:(CIImage *)ciImage API_AVAILABLE(ios(5.0));
+ (UIImage *)imageWithCIImage:(CIImage *)ciImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation API_AVAILABLE(ios(6.0));
#endif
```  
### 属性
+  CGSize size; 
	+ 单位是points
	+ 举个例子：一个2X图的像素点事100X00——对应的imagesize是50*50
+ CGFloat scale
	+   当图片是从 Assetcatlog读取时，该属性有对应的值
	+   若不是从 Asset Catalog 里面读取的图片，默认值是1
+   上述多种初始化 UIImage的方法，我们可以通过调用带Scale参数的更改image的size

### 2x手机展示3X图和3X手机展示2X图会有什么问题？
+ 首先在图片的尺寸上不会有任何问题
	+ 因为 UiImage 的size是point，布局的单位也是Point，而即使调用sizetofit等相关方法取适应与Image的size，image的size = 像素点/Scale，所以2x手机展示3X图和3X手机展示2X图会有什么问题
+ 图片质量上
	+ 2X手机展示3X图会舍弃像素点，不会影响质量
	+ 3X手机（一个point需要3个像素点），由于2X图像素点不足，会自己补充，导致图片质量下降
+ 什么情况会影响图片大小布局，如何解决呢？
	+  影响布局
		+ 原有的图片像素为X*Y，我们更改为其他，但是仍然放入Asset Catalog 中，且使用时用了sizetofit 回导致 该图比原来有变化
		+ 改回去就好
		
		```   
		UIImage *image = [self tt_imageNamed:name inBundle:bundle compatibleWithTraitCollection:traitCollection];  
		 return [[UIImage alloc] initWithCGImage:image.CGImage scale:0.25 *[UIScreen mainScreen].scale  
		 orientation:image.imageOrientation]  
```   

## UIImageAsset API
只需关系下面几个API，具体用处后面介绍缓存的时候会讲

```  
- (UIImage *)imageWithConfiguration:(UIImageConfiguration *)configuration; // Images returned hold a strong reference to the asset that created them
- (UIImage *)imageWithTraitCollection:(UITraitCollection *)traitCollection; // Images returned hold a strong reference to the asset that created them


- (void)registerImage:(UIImage *)image withConfiguration:(UIImageConfiguration *)configuration;
- (void)unregisterImageWithConfiguration:(UIImageConfiguration *)configuration; // removes only those images added with registerImage:withConfiguration:
- (void)registerImage:(UIImage *)image withTraitCollection:(UITraitCollection *)traitCollection; // Adds a new variation to this image asset that is appropriate for the provided traits. Any traits not exposed by asset catalogs (such as forceTouchCapability) are ignored.
- (void)unregisterImageWithTraitCollection:(UITraitCollection *)traitCollection; // removes only those images added with registerImage:withTraitCollection:
@end
```   
# imageNamed相关方法加载流程

# imageWithContentsOfFile加载流程
# 图片从APP中加载到屏幕展示流程总结
# 缓存原理
